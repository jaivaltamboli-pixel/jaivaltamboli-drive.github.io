<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Research Vault Docs</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono&family=Merriweather&display=swap" rel="stylesheet">

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: Inter, system-ui;
  background: #0b0b0c;
  color: #eaeaea;
  height: 100vh;
  display: flex;
}

/* Sidebar */
aside {
  width: 260px;
  background: #121214;
  border-right: 1px solid #222;
  padding: 16px;
  display: flex;
  flex-direction: column;
}

aside h2 {
  font-size: 1rem;
  margin-bottom: 10px;
  color: #ffcc00;
}

#docs {
  flex: 1;
  overflow-y: auto;
}

.doc {
  padding: 10px;
  border-radius: 8px;
  cursor: pointer;
  margin-bottom: 6px;
}
.doc:hover { background: #1a1a1d; }

aside button {
  margin-top: 10px;
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: #ffcc00;
  font-weight: 700;
  cursor: pointer;
}

/* Main */
main {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.toolbar {
  display: flex;
  gap: 10px;
  padding: 10px;
  border-bottom: 1px solid #222;
  background: #111;
}

.toolbar button, .toolbar select {
  background: #1a1a1d;
  border: 1px solid #333;
  color: #fff;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
}

.editor {
  flex: 1;
  padding: 32px;
  outline: none;
  overflow-y: auto;
  font-size: 1rem;
  line-height: 1.7;
}

/* Fonts */
.font-inter { font-family: Inter; }
.font-serif { font-family: Merriweather; }
.font-mono { font-family: "JetBrains Mono"; }
</style>
</head>

<body>

<aside>
  <h2>Documents</h2>
  <div id="docs"></div>
  <button onclick="newDoc()">＋ New</button>
</aside>

<main>
  <div class="toolbar">
    <button onclick="cmd('bold')"><b>B</b></button>
    <button onclick="cmd('italic')"><i>I</i></button>
    <button onclick="cmd('insertUnorderedList')">• List</button>

    <select onchange="setFont(this.value)">
      <option value="font-inter">Inter</option>
      <option value="font-serif">Serif</option>
      <option value="font-mono">Mono</option>
    </select>

    <span id="status" style="margin-left:auto;color:#aaa;">Saved</span>
  </div>

  <div id="editor" class="editor font-inter" contenteditable="true"></div>
</main>

<script>
/* Supabase config — already filled */
const SUPABASE_URL = "https://sheeqpvmdrksdrxwxdfs.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNoZWVxcHZtZHJrc2RyeHd4ZGZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3NzMyMjEsImV4cCI6MjA4NzM0OTIyMX0.SEub1Atcb68cRwbm5lAB8Iv4cs1fFyJ5moVz8pAXmVk";

const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentDoc = null;
const editor = document.getElementById("editor");
const status = document.getElementById("status");

/* Formatting */
function cmd(c) { document.execCommand(c); }
function setFont(cls) { editor.className = "editor " + cls; }

/* Load docs */
async function loadDocs() {
  const { data } = await supabase
    .from("documents")
    .select("*")
    .order("created_at", { ascending: false });

  const list = document.getElementById("docs");
  list.innerHTML = "";

  data.forEach(doc => {
    const div = document.createElement("div");
    div.className = "doc";
    div.textContent = doc.title || "Untitled";
    div.onclick = () => openDoc(doc);
    list.appendChild(div);
  });
}

/* Open doc */
function openDoc(doc) {
  currentDoc = doc;
  editor.innerHTML = doc.content || "";
}

/* New doc */
async function newDoc() {
  const { data } = await supabase
    .from("documents")
    .insert({ title: "New Document", content: "" })
    .select()
    .single();

  loadDocs();
  openDoc(data);
}

/* Autosave */
let timeout;
editor.addEventListener("input", () => {
  status.textContent = "Saving…";
  clearTimeout(timeout);
  timeout = setTimeout(saveDoc, 600);
});

async function saveDoc() {
  if (!currentDoc) return;
  await supabase
    .from("documents")
    .update({
      content: editor.innerHTML,
      updated_at: new Date()
    })
    .eq("id", currentDoc.id);

  status.textContent = "Saved";
}

/* Init */
loadDocs();
</script>

</body>
</html>
